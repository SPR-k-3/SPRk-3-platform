#!/usr/bin/env python3
"""Fix torch.load vulnerability in SPRK3"""

import sys

def fix_torch_load(filename):
    with open(filename, 'r') as f:
        lines = f.readlines()
    
    # Fix line 356
    if 'torch.load(model_path)' in lines[355]:
        print(f"ðŸ”§ Fixing vulnerability at line 356")
        lines[355] = lines[355].replace(
            'torch.load(model_path)',
            'torch.load(model_path, map_location="cpu", weights_only=True)'
        )
        
        with open(filename, 'w') as f:
            f.writelines(lines)
        print("âœ… Vulnerability patched!")
    else:
        print("Line doesn't match expected pattern")

if __name__ == "__main__":
    fix_torch_load("agentland_defense/sprk3_base_model_defender.py")
